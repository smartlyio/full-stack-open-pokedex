name: rollback deployment

on:
    workflow_run:
        workflows: ["pipeline"]
        types: 
            - completed

jobs:
    deployment:
        runs-on: ubuntu-20.04

        steps:
            - uses: actions/checkout@v3
              with: 
                ref: rollback-state
                fetch-depth: 0
            - uses: actions/setup-node@v3
              with:
                node-version: '16'
            
            - name: install dependencies
              run: npm install
            
            - name: deploy
              uses: superfly/flyctl-actions/setup-flyctl@master
            - run: flyctl deploy --remote-only
              env:
                FLY_API_TOKEN: ${{ secrets.FLY_API_TOKEN }}